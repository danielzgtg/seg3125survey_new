!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/",n(n.s="Bm4k")}({"17wl":function(e,t){e.exports=require("tslib")},"8IVn":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.post=void 0;const r=n("17wl"),o=n("Ndaz"),s=r.__importDefault(n("ABJj"));t.post=function(e){const t=o.coerce(e);s.default.post(t)}},"8UGb":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n("17wl"),o=r.__importDefault(n("ZEFf")),s=r.__importDefault(n("oyvS"));t.default=function(e){e.use("/",o.default.static(s.default.join(__dirname,"static"))),e.get("/niceSurvey",(e,t)=>{t.redirect(301,"/")})}},ABJj:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SurveyDB=void 0;const r=n("17wl"),o=r.__importDefault(n("dfd3")),s=r.__importDefault(n("Np68")),i=n("BxWd"),a=n("GEcH");r.__importDefault(n("SkUF")).default();class u{constructor(e){this.db=e,i.initDB(e),this.reader=new o.default(e);const t=this.writer=new s.default(e);this.doPost=e.transaction(e=>{t.article(e.article),t.category(e.category),t.understand(e.understand),t.rating(e.rating),t.best(e.best),t.worst(e.worst)})}get(){const{reader:e}=this;return{article:e.article(),category:e.category(),understand:e.understand(),rating:e.rating(),best:e.best(),worst:e.worst()}}post(e){this.doPost(e)}close(){this.db.close()}}t.SurveyDB=u;const c=new u(a.locateDB());t.default=c},Bm4k:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n("17wl"),o=n("he5r"),s=r.__importDefault(n("OkUf")),i=r.__importDefault(n("ABJj")),a=r.__importDefault(n("ZEFf")),u=r.__importDefault(n("XAHE")),c=r.__importDefault(n("8UGb")),l=a.default();o.DEBUG&&l.use((e,t,n)=>{console.log(`${s.default.blue(e.method)} ${s.default.red(e.path)}`),n()}),u.default(l),c.default(l);const E=l.listen(o.PORT,()=>{console.log(`${s.default.cyan("Lab 6")} ${s.default.magenta("started")}`),console.log(`${s.default.magenta("Fill out the survey")} ${s.default.yellow("at")} http://localhost:${o.PORT}/niceSurvey`),console.log(`${s.default.magenta("See the results")} ${s.default.yellow("at")} http://localhost:${o.PORT}/analysis`)});process.on("exit",()=>{console.log(s.default.red("Stopping...")),i.default.close(),E.close(),console.log(s.default.red("Goodbye"))}),process.on("SIGHUP",()=>process.exit(129)),process.on("SIGINT",()=>process.exit(130)),process.on("SIGTERM",()=>process.exit(143))},BxWd:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.initDB=void 0,t.initDB=function(e){e.pragma("journal_mode = WAL"),e.transaction(()=>{e.prepare("\nCREATE TABLE IF NOT EXISTS ARTICLE(\nid INTEGER PRIMARY KEY AUTOINCREMENT,\nname TEXT NOT NULL UNIQUE,\nfrequency INTEGER NOT NULL DEFAULT(1)\n)\n").run(),e.prepare("\nCREATE TABLE IF NOT EXISTS CATEGORY(\nid INTEGER PRIMARY KEY CHECK (id = 0),\nculture INTEGER NOT NULL DEFAULT(0),\nentertainment INTEGER NOT NULL DEFAULT(0),\ngeography INTEGER NOT NULL DEFAULT(0),\nhistory INTEGER NOT NULL DEFAULT(0),\npeople INTEGER NOT NULL DEFAULT(0),\npolitics INTEGER NOT NULL DEFAULT(0),\nscience INTEGER NOT NULL DEFAULT(0),\nsports INTEGER NOT NULL DEFAULT(0),\ntechnology INTEGER NOT NULL DEFAULT(0)\n)\n").run(),e.prepare("\nINSERT OR IGNORE INTO CATEGORY(id) VALUES(0)\n").run(),e.prepare("\nCREATE TABLE IF NOT EXISTS UNDERSTAND(\nid INTEGER PRIMARY KEY CHECK (id = 0),\nyes INTEGER NOT NULL DEFAULT(0),\nno INTEGER NOT NULL DEFAULT(0)\n)\n").run(),e.prepare("\nINSERT OR IGNORE INTO UNDERSTAND(id) VALUES (0)\n").run(),e.prepare("\nCREATE TABLE IF NOT EXISTS RATING(\nid INTEGER PRIMARY KEY CHECK (id = 0),\n`1` INTEGER NOT NULL DEFAULT(0),\n`2` INTEGER NOT NULL DEFAULT(0),\n`3` INTEGER NOT NULL DEFAULT(0),\n`4` INTEGER NOT NULL DEFAULT(0),\n`5` INTEGER NOT NULL DEFAULT(0)\n)\n").run(),e.prepare("\nINSERT OR IGNORE INTO RATING(id) VALUES(0)\n").run(),e.prepare("\nCREATE TABLE IF NOT EXISTS BEST(\nid INTEGER PRIMARY KEY CHECK (id = 0),\nnav INTEGER NOT NULL DEFAULT(0),\ncolours INTEGER NOT NULL DEFAULT(0),\ntext INTEGER NOT NULL DEFAULT(0),\neditor INTEGER NOT NULL DEFAULT(0)\n)\n").run(),e.prepare("\nINSERT OR IGNORE INTO BEST(id) VALUES(0)\n").run(),e.prepare("\nCREATE TABLE IF NOT EXISTS WORST(\nid INTEGER PRIMARY KEY CHECK (id = 0),\nnav INTEGER NOT NULL DEFAULT(0),\ncolours INTEGER NOT NULL DEFAULT(0),\ntext INTEGER NOT NULL DEFAULT(0),\neditor INTEGER NOT NULL DEFAULT(0)\n)\n").run(),e.prepare("\nINSERT OR IGNORE INTO WORST(id) VALUES(0)\n").run()})()}},GEcH:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.locateDB=t.registerDB=t.hasDB=void 0;let r=void 0;t.hasDB=function(){return!!r},t.registerDB=function(e){if(r)throw new TypeError;r=e},t.locateDB=function(){if(!r)throw new TypeError;return r}},Ndaz:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.coerce=void 0;const r=["article","category","understand","rating","best","worst"];t.coerce=function(e){if(Object.keys(e).some(e=>!r.includes(e)))throw new TypeError;const{article:t,category:n,understand:o,rating:s,best:i,worst:a}=e;if("string"!=typeof t||"string"!=typeof n||"boolean"!=typeof o||"number"!=typeof s||"string"!=typeof i||"string"!=typeof a)throw new TypeError;switch(n){case"culture":case"entertainment":case"geography":case"history":case"people":case"politics":case"science":case"sports":case"technology":break;default:throw new TypeError}switch(s){case 1:case 2:case 3:case 4:case 5:break;default:throw new TypeError}switch(i){case"nav":case"colours":case"text":case"editor":break;default:throw new TypeError}switch(a){case"nav":case"colours":case"text":case"editor":break;default:throw new TypeError}return{article:t,category:n,understand:o,rating:s,best:i,worst:a}}},Np68:function(e,t,n){"use strict";function r(e){let t=0,n=0,r=0,o=0;switch(e){case"nav":t=1;break;case"colours":n=1;break;case"text":r=1;break;case"editor":o=1;break;default:throw new TypeError}return[t,n,r,o]}Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(e){this.db=e,this.ARTICLE=e.prepare("\nINSERT INTO ARTICLE(name)\nVALUES (?)\nON CONFLICT(name) DO UPDATE SET\nfrequency=frequency+1\n"),this.CATEGORY=e.prepare("\nUPDATE CATEGORY SET\nculture = culture + ?,\nentertainment = entertainment + ?,\ngeography = geography + ?,\nhistory = history + ?,\npeople = people + ?,\npolitics = politics + ?,\nscience = science + ?,\nsports = sports + ?,\ntechnology = technology + ?\n"),this.UNDERSTAND=e.prepare("\nUPDATE UNDERSTAND SET\nyes = yes + ?,\nno = no + ?\n"),this.RATING=e.prepare("\nUPDATE RATING SET\n`1` = `1` + ?,\n`2` = `2` + ?,\n`3` = `3` + ?,\n`4` = `4` + ?,\n`5` = `5` + ?\n"),this.BEST=e.prepare("\nUPDATE BEST SET\nnav = nav + ?,\ncolours = colours + ?,\ntext = text + ?,\neditor = editor + ?\n"),this.WORST=e.prepare("\nUPDATE WORST SET\nnav = nav + ?,\ncolours = colours + ?,\ntext = text + ?,\neditor = editor + ?\n")}article(e){this.ARTICLE.run(e)}category(e){let t=0,n=0,r=0,o=0,s=0,i=0,a=0,u=0,c=0;switch(e){case"culture":t=1;break;case"entertainment":n=1;break;case"geography":r=1;break;case"history":o=1;break;case"people":s=1;break;case"politics":i=1;break;case"science":a=1;break;case"sports":u=1;break;case"technology":c=1}this.CATEGORY.run(t,n,r,o,s,i,a,u,c)}understand(e){this.UNDERSTAND.run(e?1:0,e?0:1)}rating(e){const t=1<<e-1;this.RATING.run(1&t,t>>1&1,t>>2&1,t>>3&1,t>>4&1)}best(e){this.BEST.run(r(e))}worst(e){this.WORST.run(r(e))}}},OkUf:function(e,t){e.exports=require("chalk")},SWt3:function(e,t){e.exports=require("body-parser")},SkUF:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n("17wl"),o=n("GEcH"),s=r.__importDefault(n("tGqd"));t.default=function(){o.hasDB()?console.log("Ignoring regular DB not registered (allowing for mock)"):o.registerDB(new s.default("survey.db"))}},XAHE:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n("17wl").__importDefault(n("oyvS")),o=n("r89p"),s=n("hmo4");t.default=function(e){e.set("views",r.default.join(__dirname,"dynamic")),e.set("view engine","ejs"),s.setupSubmit(e),o.setupResults(e),e.get("/analysis",(e,t)=>{t.redirect(301,"/results.html")})}},ZEFf:function(e,t){e.exports=require("express")},ZVH3:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.get=void 0;const r=n("17wl").__importDefault(n("ABJj"));t.get=function(){return r.default.get()}},dfd3:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(e){this.db=e,this.ARTICLE=e.prepare("\nSELECT name, frequency FROM ARTICLE\n"),this.CATEGORY=e.prepare("\nSELECT\nculture, entertainment, geography, history,\npeople, politics, science, sports, technology\nFROM CATEGORY\n"),this.UNDERSTAND=e.prepare("\nSELECT yes, no FROM UNDERSTAND\n"),this.RATING=e.prepare("\nSELECT `1`, `2`, `3`, `4`, `5` FROM RATING\n"),this.BEST=e.prepare("\nSELECT\nnav, colours, text, editor\nFROM BEST\n"),this.WORST=e.prepare("\nSELECT\nnav, colours, text, editor\nFROM WORST\n")}article(){return this.ARTICLE.all()}category(){return this.CATEGORY.get()}understand(){return this.UNDERSTAND.get()}rating(){return this.RATING.get()}best(){return this.BEST.get()}worst(){return this.WORST.get()}}},he5r:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DEBUG=t.PORT=void 0,t.PORT=3e3,t.DEBUG=!0},hmo4:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setupSubmit=void 0;const r=n("17wl"),o=r.__importDefault(n("SWt3")),s=r.__importDefault(n("OkUf")),i=n("he5r"),a=n("8IVn");t.setupSubmit=function(e){e.post("/",o.default.json({limit:"1kb"}),(e,t)=>{i.DEBUG&&console.log(`${s.default.green("body")} ${s.default.yellow(JSON.stringify(e.body))}`),a.post(e.body),t.sendStatus(204)})}},oyvS:function(e,t){e.exports=require("path")},r89p:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setupResults=void 0;const r=n("ZVH3");t.setupResults=function(e){e.get("/results.html",(e,t)=>{const n=r.get();t.render("results",n)})}},tGqd:function(e,t){e.exports=require("better-sqlite3")}});